var ne=Object.defineProperty;var N=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var R=(b,m,c)=>m in b?ne(b,m,{enumerable:!0,configurable:!0,writable:!0,value:c}):b[m]=c,U=(b,m)=>{for(var c in m||(m={}))oe.call(m,c)&&R(b,c,m[c]);if(N)for(var c of N(m))se.call(m,c)&&R(b,c,m[c]);return b};import{r as y,h as re,i as S,o as x,g as C,w as s,d as l,u as o,j as ue,e as ce,k as z,b as T,l as ie,v as L,E as de,m as P,n as pe,p as me,q as fe,s as Y,x as q,y as _e,z as ve,A as ge,M as he,B as ye,C as be,D as we,$ as A,G as B,H as j,c as F,F as I,a as H,t as xe,I as De,J as Te,K as ke,_ as Se,L as $e,N as Ee}from"./glc-entry-c39e8b6b.js";/* empty css                  *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                  */const Ve=T("span",null,"检 索",-1),Ce={class:"c-down-panel"},Ge=T("span",null,"检 索",-1),Oe=T("span",null,"收 起",-1),Ke={__name:"SearchForm",props:{data:{type:Object,default(){return{}}},rules:{type:Object,default(){return{}}}},emits:["search"],setup(b,{emit:m}){const c=b,f=y(c.data),g=y(U({},c.data)),r=y(c.rules),G=y(),u=y(!1),$=()=>{u.value=!1,m("search",1)},O=()=>{const h=Object.keys(f.value);for(const n of h)!f.value[n]&&!g.value[n]||(!f.value[n]&&g.value[n]?f.value[n]=g.value[n]:f.value[n]&&!g.value[n]?f.value[n]=null:Array.isArray(g.value[n])?f.value[n]=g.value[n].slice(0):f.value[n]=g.value[n]);u.value=!1,m("search",1)},k=re(()=>{for(const[h,n]of Object.entries(f.value))if(h!="searchKeys"){if(n){if(Array.isArray(n))if(g.value[h]){if(n.length!=g.value[h].length)return!1;for(let _=0;_<n.length;_++)if(n[_]!=g.value[h][_])return!1}else{if(n.length)return!1;continue}else if(n!=g.value[h])return!1}else if(g.value[h])return!1}return!0});return(h,n)=>{const _=S("Search"),D=de,w=P,E=pe,K=me,V=S("ArrowUp"),M=S("ArrowDown"),e=fe,t=Y,a=q,i=_e,v=ve;return x(),C(v,{ref_key:"form",ref:G,inline:!0,model:o(f),rules:o(r),"label-width":"100"},{default:s(()=>[l(a,null,{default:s(()=>[l(t,{class:"c-search-form-item"},{default:s(()=>[l(E,{modelValue:o(f).searchKeys,"onUpdate:modelValue":n[0]||(n[0]=d=>o(f).searchKeys=d),placeholder:"请输入关键词检索，支持多关键词","input-style":"width:500px;height: 30px",onKeyup:ue($,["enter"])},{append:s(()=>[l(w,{type:"primary",class:"c-btn-search",style:{height:"30px",color:"white","background-color":"#0081dd"},onClick:$},{default:s(()=>[l(D,null,{default:s(()=>[l(_)]),_:1}),Ve]),_:1})]),_:1},8,["modelValue","onKeyup"]),l(K,{icon:"refresh-left",style:{"margin-left":"108px"},onClick:O},{default:s(()=>[ce("重 置")]),_:1}),l(e,{"is-dot":"",hidden:o(k),style:{"margin-left":"12px"},type:"primary",class:"c-btn-badge"},{default:s(()=>[l(w,{circle:"",onClick:n[1]||(n[1]=()=>u.value=!o(u))},{default:s(()=>[l(D,null,{default:s(()=>[o(u)?(x(),C(V,{key:0})):(x(),C(M,{key:1}))]),_:1})]),_:1})]),_:1},8,["hidden"])]),_:1})]),_:1}),z(T("div",Ce,[ie(h.$slots,"default"),l(i,{style:{margin:"0 0 10px"}}),l(a,{justify:"center"},{default:s(()=>[l(w,{type:"primary",class:"c-btn",onClick:$},{default:s(()=>[l(D,{size:"14"},{default:s(()=>[l(_)]),_:1}),Ge]),_:1}),l(w,{class:"c-btn",onClick:n[2]||(n[2]=()=>u.value=!1)},{default:s(()=>[l(D,{size:"14"},{default:s(()=>[l(V)]),_:1}),Oe]),_:1})]),_:1})],512),[[L,o(u)]])]),_:3},8,["model","rules"])}}};const Me={style:{display:"flex","justify-content":"space-between"}},Ae=["textContent"],Ie={__name:"GlcMain",setup(b){const m=ge(),c=he(m.activePath),f=ye(),g={emitter:c,withoutSearchForm:!0},{formData:r,visible:G,tableData:u,tableHeight:$,pageSettingStore:O,showTableLoadding:k}=be(g),h=y(),n=y("glcMain"),_=y(""),D=y([]),w=new Set,E=y([]),K=y([{text:"近5分钟",value:()=>{const e=new Date;return e.setTime(e.getTime()-5*60*1e3),[e,new Date]}},{text:"近10分钟",value:()=>{const e=new Date;return e.setTime(e.getTime()-10*60*1e3),[e,new Date]}},{text:"近15分钟",value:()=>{const e=new Date;return e.setTime(e.getTime()-15*60*1e3),[e,new Date]}},{text:"近20分钟",value:()=>{const e=new Date;return e.setTime(e.getTime()-20*60*1e3),[e,new Date]}},{text:"近30分钟",value:()=>{const e=new Date;return e.setTime(e.getTime()-30*60*1e3),[e,new Date]}},{text:"近1小时",value:()=>{const e=new Date;return e.setTime(e.getTime()-60*60*1e3),[e,new Date]}},{text:"近2小时",value:()=>{const e=new Date;return e.setTime(e.getTime()-2*60*60*1e3),[e,new Date]}},{text:"近3小时",value:()=>{const e=new Date;return e.setTime(e.getTime()-3*60*60*1e3),[e,new Date]}},{text:"近4小时",value:()=>{const e=new Date;return e.setTime(e.getTime()-4*60*60*1e3),[e,new Date]}}]);we(()=>{k.value=!0,A("/v1/store/names",{},null,{"Content-Type":"application/x-www-form-urlencoded"}).then(a=>{if(a.success){const i=a.result||[];for(let v=0;v<i.length;v++)D.value.push({value:i[v],label:`日志仓：${i[v]}`})}else a.code==403&&(B(),f.push("/login"))}),document.querySelector(".c-glc-table .el-scrollbar__wrap").addEventListener("scroll",a=>{a.target.scrollHeight-a.target.scrollTop-a.target.clientHeight<=0&&M()}),V()});function V(){k.value=!0;const e="/v1/log/search",t={};t.searchKey=r.value.searchKeys,t.storeName=r.value.storage,t.system=r.value.system,t.loglevel=r.value.loglevel,t.datetimeFrom=(r.value.datetime||["",""])[0],t.datetimeTo=(r.value.datetime||["",""])[1],A(e,t,null,{"Content-Type":"application/x-www-form-urlencoded"}).then(a=>{if(a.success){const i=a.result.data||[],v=a.result.pagesize-0;u.value.splice(0,u.value.length),document.querySelector(".c-glc-table .el-scrollbar__wrap").scrollTop=0,j(()=>{i.forEach(d=>{u.value.push(d),d.system&&!w.has(d.system)&&w.add(d.system)&&E.value.push({value:d.system,label:d.system})}),i.length<v?_.value=`日志总量 ${a.result.total} 条，当前条件最多匹配 ${u.value.length} 条，正展示前 ${u.value.length} 条`:_.value=`日志总量 ${a.result.total} 条，当前条件最多匹配 ${a.result.count} 条，正展示前 ${u.value.length} 条`})}else a.code==403&&(B(),f.push("/login"))}).finally(()=>{k.value=!1})}function M(){if(u.value.length>=5e3){_.value.indexOf("请考虑")<0&&(_.value+=" （数据太多不再自动加载，请考虑添加条件）");return}const e="/v1/log/search",t={};t.searchKey=r.value.searchKeys,t.storeName=r.value.storage,t.system=r.value.system,t.loglevel=r.value.loglevel,t.datetimeFrom=(r.value.datetime||["",""])[0],t.datetimeTo=(r.value.datetime||["",""])[1],t.forward=!0,t.currentId=u.value[u.value.length-1].id,A(e,t,null,{"Content-Type":"application/x-www-form-urlencoded"}).then(a=>{if(a.success){const i=a.result.data||[],v=a.result.pagesize-0;u.value.push(...i),i.length<v?_.value=`日志总量 ${a.result.total} 条，当前条件最多匹配 ${u.value.length} 条，正展示前 ${u.value.length} 条`:_.value=`日志总量 ${a.result.total} 条，当前条件最多匹配 ${a.result.count} 条，正展示前 ${u.value.length} 条`,j(()=>{i.forEach(d=>{d.system&&!w.has(d.system)&&w.add(d.system)&&E.value.push({value:d.system,label:d.system})})})}else a.code==403&&B()})}return(e,t)=>{const a=De,i=Te,v=Y,d=ke,W=q,J=Ke,Q=Se,X=P,Z=$e,ee=S("GxPageTableConfig"),te=S("GxToolbar"),le=S("GxTable"),ae=Ee;return z((x(),F("div",null,[l(te,{style:{"margin-bottom":"13px"},class:"c-btn"},{left:s(()=>[l(J,{data:o(r),class:"c-search-form",onSearch:V},{default:s(()=>[l(W,null,{default:s(()=>[l(v,{label:"选择日志仓"},{default:s(()=>[l(i,{modelValue:o(r).storage,"onUpdate:modelValue":t[0]||(t[0]=p=>o(r).storage=p),filterable:"",placeholder:"请选择",style:{width:"420px"}},{default:s(()=>[(x(!0),F(I,null,H(o(D),p=>(x(),C(a,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"系统名"},{default:s(()=>[l(i,{modelValue:o(r).system,"onUpdate:modelValue":t[1]||(t[1]=p=>o(r).system=p),multiple:!1,filterable:"","allow-create":"","default-first-option":"",style:{width:"420px"},clearable:"","reserve-keyword":!0,placeholder:"请输入系统名"},{default:s(()=>[(x(!0),F(I,null,H(o(E),p=>(x(),C(a,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"日志级别"},{default:s(()=>[l(i,{modelValue:o(r).loglevel,"onUpdate:modelValue":t[2]||(t[2]=p=>o(r).loglevel=p),multiple:!1,clearable:"","reserve-keyword":!0,style:{width:"420px"},placeholder:"请选择..."},{default:s(()=>[l(a,{label:"ERROR",value:"error"}),l(a,{label:"WARN",value:"warn"}),l(a,{label:"INFO",value:"info"}),l(a,{label:"DEBUG",value:"debug"})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"时间范围"},{default:s(()=>[l(d,{modelValue:o(r).datetime,"onUpdate:modelValue":t[3]||(t[3]=p=>o(r).datetime=p),type:"datetimerange",shortcuts:o(K),"range-separator":"～","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间","popper-class":"c-datapicker"},null,8,["modelValue","shortcuts"])]),_:1})]),_:1})]),_:1},8,["data"])]),right:s(()=>[l(Z,{content:"缩放",placement:"top"},{default:s(()=>[l(X,{circle:"",onClick:t[4]||(t[4]=p=>o(c).emit("main:switchMaximizePage"))},{default:s(()=>[l(Q,{name:"zoom"})]),_:1})]),_:1}),l(ee,{tid:o(n),"page-config":o(O)},null,8,["tid","page-config"])]),_:1}),z(l(le,{ref_key:"table",ref:h,"enable-header-contextmenu":!1,"enable-first-expand":!0,stripe:"",tid:o(n),data:o(u),height:o($),class:"c-gx-table c-glc-table","row-key":"id"},null,8,["tid","data","height"]),[[ae,o(k)]]),T("div",null,[T("div",Me,[T("div",{style:{"min-height":"30px","padding-top":"5px","line-height":"30px",color:"#909399"},textContent:xe(o(_))},null,8,Ae)])])],512)),[[L,o(G)]])}}};export{Ie as default};
